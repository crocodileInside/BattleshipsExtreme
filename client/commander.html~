<!DOCTYPE html>
	<head>
		<title>Schiffe Versenken Extreme</title>
		
		<meta charset="utf-8">
		<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
		
		<link rel="stylesheet" type="text/css" href="main.css">
		
		<script type="text/javascript" src="js/jquery-2.0.3.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui.js"></script>
		<script type="text/javascript" src="js/qr/sha1.js"></script>
		<script type="text/javascript" src="js/CardDatabase.js"></script>
		<script type="text/javascript" src="js/qr/qrscanner.js"></script>
		<!--<script type="text/javascript" src="js/ClientMain.js"></script>-->
		<script src='https://cdn.firebase.com/v0/firebase.js'></script>
		
		<script type="text/javascript">
			// Commander
			var fbref = new Firebase('https://battleships.firebaseio.com/cc/');
			
			var clients = new Array();
			
			
			function pushMessage(msg)
			{
				fbref.push(msg);
			}
			
			fbref.on('child_added', function(snapshot) {
				parseMessage(snapshot);
			});
			
			
			function parseMessage(snapshot)
			{
				var message = snapshot.val();
				
				if(message == 'clientInit')
				{
					console.log('got handshake request');
					if(clients.length < 2)
					{
						pushMessage({action: 'clientInit', clientID: clients.length});
						clients.push({clientStatus: 1, clientName: '', clientShips: {} });
						$('div#clientStatus' + clients.length).text('Connected');
					}else
					{
						pushMessage({action: 'clientInit', error: 'Server full'});
					}
					
				}else if(message.action)
				{
					switch(message.action)
					{
						case 'clientReady':
							var clientID = message.clientID;
							this.clients[clientID].clientStatus = 2;
							this.clients[clientID].clientName = message.clientName;
							this.clients[clientID].clientShips = message.clientShips;
							
							setTimeout(function(){ pushMessage({clientID: clientID, action: 'gameReady'}); }, 1);
							$('div#clientStatus' +  clientID).text('Ready');
						break;
						
						
						
						
						
					}
				}
			}
			
			
			$('#messageInput').keypress(function (e) {
				if (e.keyCode == 13) {
				var name = $('#nameInput').val();
				var text = $('#messageInput').val();
				fbref.push({name: name, text: text});
				$('#messageInput').val('');
				}
			});
			
			
			function displayChatMessage(name, text) {
				$('<div/>').text(text).prepend($('<em/>').text(name+': ')).appendTo($('#messagesDiv'));
				$('#messagesDiv')[0].scrollTop = $('#messagesDiv')[0].scrollHeight;
			};
		
		
			$(document).ready(function() {
				fbref.remove();
				
			});
		</script>
	</head>
	
	<body>
		<div id="preparationContainer">
			<div id="gameField">
			
			</div>
		</div>
		
		<div id="gameContainer">
			<div id="clientStatusContainer">
				<div id="clientStatus0">Not connected</div>
				<div id="clientStatus1">Not connected</div>
			</div>
			
			<div id="cardContainer">
				<div class="cardItem"><img src="img/schuss.png">Schuss</div>
				<div class="cardItem"><img src="img/schuss.png">Schuss</div>
				<div class="cardItem"><img src="img/schuss.png">Schuss</div>
				<div class="cardItem"><img src="img/schuss.png">Schuss</div>
				<div class="cardItem"><img src="img/schuss.png">Schuss</div>
				<div class="cardItem"><img src="img/schuss.png">Schuss</div>
				<div class="cardItem"><img src="img/schuss.png">Schuss</div>
				<div class="cardItem"><img src="img/schuss.png">Schuss</div>
			</div>
			
			<div id="chatContainer"></div>
			
			<div id="scanContainer">
				<button id="btnScanCard">Karte Scannen</button>
				<video id="scanVideoFrame" autoplay></video>
				<canvas id="qr-canvas"></canvas>
			</div>
		</div>
	</body>
</html>